<% layout("./layouts/boilerplate.ejs") %>
<body>
    <h3 style="padding-left: 5rem;">Listing Details: </h3>
    <ul>
        <li><%= listing.title %></li>
        <li><%= listing.description %></li>
        <li><%= listing.location %></li>
        <li><%= listing.country %></li>
        <li>&#8377;<%= listing.price %></li>
    </ul>  
    <%if(user._id.equals(listing.owner._id)){%>
        <form action="/listings/<%= listing._id %>/edit" method="get">
            <button>Edit</button>
        </form>
        <br>
        <form action="/listings/<%= listing._id %>?_method=DELETE" method="post">
        <button>
            Delete
        </button></form>
    <% } %> 
    
    <hr>
    <%if(user) { %>
    <h3>Leave a Review</h3>
    <form action="/listings/<%= listing._id %>/reviews" method="post">
        <label for="rating">Rating</label>
        <input type="range" min="1" max="5" name="review[rating]" id="rating" required>
        <br>
        <label for="comment">Comment</label>
        <textarea name="review[comment]" id="comment" required></textarea>
        <br>
        <br>
        <button type="submit">Add Review</button>
        <br>
    </form>
    <%}%>
    <hr>
    <% if(listing.review.length === 0){%>
        <h4>No Reviews yet !</h4>
    <% } else { %>
    <h4>All Reviews</h4>
    <ul>
        <% for( let review of listing.review){ %>
            <li><div class="rev-container" style="border: 0.1rem solid #fe424d ;margin: 1rem; padding:1rem ;" >
                <div><%= review.author.username %></div>
                <div><b><%= review.rating %> stars</b></div>
                <div><%= review.comment %></div>
                <br>
                <form action="/listings/<%= listing._id %>/reviews/<%=review._id%>?_method=DELETE" method="post">
                    <button>Delete</button>
                </form>
            </div>
            </li>
        <% } %>
    </ul>
    <% } %>
</body>
